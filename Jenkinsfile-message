#!groovy
import groovy.json.JsonSlurper
@Grab(group='org.java-websocket', module='Java-WebSocket', version='1.3.0')

import org.java_websocket.drafts.draft_6455
node {
println System.getProperty("java.ext.dirs")
stage('send report') {
        echo 'Going to create bin'
        def createBody = """
{
  "status": 200,
  "statusText": "OK",
  "httpVersion": "HTTP/1.1",
  "headers": [],
  "cookies": [],
  "content": {
    "mimeType": "text/plain",
    "text": ""
  }
}
        """
        def resp = httpRequest(
                httpMode: 'POST',
                url: 'http://mockbin.org/bin/create',
                validResponseCodes: '100:299',
                requestBody: createBody.toString()
        )
 
        def testmesg = httpRequest( 
               httpMode: 'POST', 
               requestBody: '{"messageId":1, "timestamp":5678, "protocolVersion":"1.0.0", "messageData":{"mMX":1234, "mPermGen":34}}', 
               validResponseCodes: '100:299', 
               url: 'http://10.101.1.80:8080/message'
        )
        println "-----------------------"
        println testmesg.content.toString()


        println "-----------------------"
        def jsonSlrpBody = new JsonSlurper().parseText(resp.content)
        println jsonSlrpBody.toString()

        println "-----------------------"
        def jsonSlrpHeaders = resp.headers
        println jsonSlrpHeaders

    
}



}

